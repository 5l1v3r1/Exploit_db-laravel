<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Gallery;
class GalleryController extends Controller
{
    public function __construct()
    {
        $this->middleware('permission:manage-gallery' , ['except' => ['index']]);
    }
    public function index()
    {
    	$gallery = Gallery::all();
    	return view('admin.gallery.index' , ['gallery' => $gallery]);
    }
    public function store(Request $request)
    {
    	$this->validate($request , [
            'image' => 'required|mimes:jpeg,jpg,png',
        ]);
    	$file = $request->file('image');
        $fileToStorage = md5(time()).'.'.$file->getClientOriginalExtension();
        $destinationPath = public_path('/images/gallery/');
        $file->move($destinationPath, $fileToStorage);
        $exploit = new Gallery();
        $exploit->image = $fileToStorage;
        $exploit->save();
        return redirect()->route('gallery.index');
    }
    public function destroy($id)
    {
    	$image = Gallery::findOrFail($id);
    	unlink(public_path('/images/gallery/'.$image->image));
    	$image->delete();
        return redirect()->route('gallery.index');
    }
    
}
